

## 基础信息

- API基础路径: `http://localhost:8000`
- 认证方式: OAuth2 Bearer Token
- 响应格式: JSON

## 用户管理接口

### 1. 用户注册

**接口地址**: `POST /user/register`

**功能描述**: 用户注册新账号

**请求参数**:

| 参数名 | 类型 | 必须 | 描述 | 约束 |
|--------|------|------|------|------|
| username | string | 是 | 用户名 | 3-50个字符 |
| password | string | 是 | 密码 | 6-100个字符 |
| real_name | string | 否 | 真实姓名 | - |
| phone | string | 否 | 手机号码 | 11位数字，格式: 1[3-9]\d{9} |
| email | string | 否 | 邮箱 | 合法邮箱格式 |

**请求示例**:
```json
{
  "username": "testuser",
  "password": "123456",
  "real_name": "测试用户",
  "phone": "13800138000",
  "email": "test@example.com"
}
```

**响应示例**:
```json
{
  "result": "success",
  "code": 200,
  "message": "Register success",
  "data": null,
  "meta": null
}
```

**错误响应**:
- `400 Bad Request`: 用户名或密码为空，或用户名已存在

### 2. 用户登录

**接口地址**: `POST /user/login`

**功能描述**: 用户登录获取访问令牌

**请求参数**:

| 参数名 | 类型 | 必须 | 描述 | 约束 |
|--------|------|------|------|------|
| username | string | 是 | 用户名 | 3-50个字符 |
| password | string | 是 | 密码 | 6-100个字符 |

**请求示例** (表单数据):
```
username=testuser&password=123456
```

**响应示例**:
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer"
}
```

**错误响应**:
- `400 Bad Request`: 用户名或密码为空
- `401 Unauthorized`: 用户名或密码错误

### 3. 获取当前用户信息

**接口地址**: `GET /user/me`

**功能描述**: 获取当前登录用户的详细信息

**请求头**:
- `Authorization`: Bearer Token

**响应示例**:
```json
{
  "id": 1,
  "username": "testuser",
  "real_name": "测试用户",
  "phone": "13800138000",
  "email": "test@example.com",
  "role": 0,
  "status": 1
}
```

**错误响应**:
- `401 Unauthorized`: 未提供有效令牌

### 4. 修改用户密码

**接口地址**: `POST /user/password`

**功能描述**: 修改当前用户的密码

**请求头**:
- `Authorization`: Bearer Token

**请求参数**:

| 参数名 | 类型 | 必须 | 描述 | 约束 |
|--------|------|------|------|------|
| username | string | 是 | 用户名 | 3-50个字符 |
| password | string | 是 | 原密码 | 6-100个字符 |
| new_password | string | 是 | 新密码 | 6-100个字符 |

**请求示例**:
```json
{
  "username": "testuser",
  "password": "123456",
  "new_password": "654321"
}
```

**响应示例**:
```json
{
  "result": "success",
  "code": 200,
  "message": "Password changed success",
  "data": null,
  "meta": null
}
```

**错误响应**:
- `400 Bad Request`: 参数不完整
- `401 Unauthorized`: 用户名不匹配或原密码错误

### 5. 更新用户信息

**接口地址**: `PUT /user/me`

**功能描述**: 更新当前用户的信息

**请求头**:
- `Authorization`: Bearer Token

**请求参数**:

| 参数名 | 类型 | 必须 | 描述 | 约束 |
|--------|------|------|------|------|
| id | integer | 是 | 用户ID | 必须与当前用户ID匹配（普通用户） |
| username | string | 是 | 用户名 | 3-50个字符 |
| real_name | string | 否 | 真实姓名 | - |
| phone | string | 否 | 手机号码 | 11位数字，格式: 1[3-9]\d{9} |
| email | string | 否 | 邮箱 | 合法邮箱格式 |
| role | integer | 是 | 角色 | 普通用户不能修改 |
| status | integer | 是 | 状态 | 普通用户不能修改 |

**请求示例**:
```json
{
  "id": 1,
  "username": "testuser",
  "real_name": "更新后的姓名",
  "phone": "13900139000",
  "email": "updated@example.com",
  "role": 0,
  "status": 1
}
```

**响应示例**:
```json
{
  "result": "success",
  "code": 200,
  "message": "User updated success",
  "data": null,
  "meta": null
}
```

**权限说明**:
- 普通用户（role=0）: 只能更新自己的信息，且不能修改角色和状态
- 管理员（role=1）: 可以更新所有用户的信息

**错误响应**:
- `403 Forbidden`: 无权限更新指定用户
- `404 Not Found`: 用户不存在

### 6. 获取指定用户信息（管理员权限）

**接口地址**: `GET /user/{user_id}`

**功能描述**: 获取指定用户的详细信息

**请求头**:
- `Authorization`: Bearer Token

**路径参数**:
- `user_id`: 用户ID (integer)

**响应示例**:
```json
{
  "result": "success",
  "code": 200,
  "message": "User info retrieved success",
  "data": {
    "id": 1,
    "username": "testuser",
    "real_name": "测试用户",
    "phone": "13800138000",
    "email": "test@example.com",
    "role": 0,
    "status": 1
  },
  "meta": null
}
```

**权限说明**:
- 仅管理员（role=1）可访问此接口

**错误响应**:
- `403 Forbidden`: 无权限访问此接口
- `404 Not Found`: 用户不存在

### 7. 添加新用户（管理员权限）

**接口地址**: `POST /user`

**功能描述**: 管理员添加新用户

**请求头**:
- `Authorization`: Bearer Token

**请求参数**:

| 参数名 | 类型 | 必须 | 描述 | 约束 |
|--------|------|------|------|------|
| username | string | 是 | 用户名 | 3-50个字符 |
| password | string | 是 | 密码 | 6-100个字符 |
| real_name | string | 否 | 真实姓名 | - |
| phone | string | 否 | 手机号码 | 11位数字，格式: 1[3-9]\d{9} |
| email | string | 否 | 邮箱 | 合法邮箱格式 |

**请求示例**:
```json
{
  "username": "newuser",
  "password": "123456",
  "real_name": "新用户",
  "phone": "13700137000",
  "email": "new@example.com"
}
```

**响应示例**:
```json
{
  "result": "success",
  "code": 200,
  "message": "User added success",
  "data": null,
  "meta": null
}
```

**权限说明**:
- 仅管理员（role=1）可访问此接口

**错误响应**:
- `403 Forbidden`: 无权限添加用户
- `400 Bad Request`: 用户名已存在

## 通用响应格式

所有接口的响应都遵循以下格式:

```json
{
  "result": "success" | "failure",
  "code": 200 | 400 | 401 | 403 | 404,
  "message": "响应消息",
  "data": "响应数据（根据接口而定）",
  "meta": "元数据（通常为null）"
}
```

## 角色与权限说明

- **普通用户** (role=0): 只能操作自己的账号信息
- **管理员** (role=1): 可以管理所有用户账号

## 状态码说明

| 状态码 | 描述 |
|--------|------|
| 200 | 操作成功 |
| 400 | 请求参数错误 |
| 401 | 未授权（登录失败或令牌无效） |
| 403 | 禁止访问（权限不足） |
| 404 | 资源不存在 |

## 快速测试

FastAPI自动生成了Swagger文档，可以通过以下地址访问:
`http://localhost:8000/docs`

在Swagger文档中可以直接测试所有API接口。
        